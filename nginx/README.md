#  nginx

## 用途

- 静态文件服务器
  - sendfile 可以将文件从内核直接发送到网卡，无需复制到用户态
- 反向代理服务器
  - 完整读取完客户端请求体后，才跟后端建立连接，减轻了后端服务器的压力
  
## 特点

### 高可靠性

master 进程能在 worker 进程出错时快速拉起新的 worker 子进程提供服务。

### 低内存消耗

10,000 个非活跃的 HTTP Keep-Alive 连接在 nginx 仅消耗 2.5MB 内存。

### 单机支持 10 万以上的并发连接

nginx 支持的并发连接主要取决于内存。

### 热部署

不停机的情况下升级 nginx 可执行文件，更新配置文件，更换日志文件。

## 架构

### web 服务器设计的关键约束

1. 网络性能

网络性能是指在不同的负载下，web 服务在网络通信上的吞吐量。而网络连接的最大吞吐量受制于 **带宽**。
在几十万并发连接下，我们要求服务器仍然可以保持较高的网络吞吐量，而不是并发连接数达到一定数量时，服务器的CPU资源浪费在进程间切换、休眠、等待等活动上。

2. 单次请求的延时

高并发下如何保持平均延时，使其不要上升太快。

3. 网络效率

使用网络的效率。比如使用长连接代替短连接以减少建立、关闭连接带来的网络交互，使用压缩算法来增加相同吞吐量下的信息携带量，使用缓存来减少网络交互次数。

### 事件驱动架构

网络IO、磁盘IO调用均使用特定平台的非阻塞方法，调用时立刻返回并监听IO事件，等待内核处理完后通过特定事件通知，期间进程可以继续接受处理新的用户请求。

### 多工作进程设计

工作进程个数通常设置为 CPU 的核心数，以此来最大化利用多核架构下的并行执行能力。通过绑定进程到特定的 CPU，极大地减少了操作系统级别的进程间切换。

### 进程间通信机制

- 共享内存
- 原子操作
- 信号量
- 文件锁



